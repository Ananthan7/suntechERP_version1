<!-- header section starts -->
<div class="card-content border-bottom d-flex justify-content-between p-2">
    <h5 class="pos-modaltitle" id="modal-dia-metal">Metal Issue Details</h5>
    <button type="button" class="btn btn-close close-btn" (click)="close()">
        <i class="feather icon-x close-icon"></i>
    </button>
</div>
<!-- modal header component -->
<modal-header (saveClick)="formSubmit('SAVE')" (cancelClick)="close()"
    (changeJobClick)="formSubmit('CHANGEJOB')"
    (continueClick)="formSubmit('CONTINUE')" [isViewContinue]="!viewMode"
    [isViewChangeJob]="!viewMode" [isViewDelete]="false"
    [isViewMore]="false" [isViewSave]="!viewMode"></modal-header>
<div class="row">
    <div class="col-md-12">
        <form [formGroup]="metalIssueDetailsForm">
            <div class="card m-2 p-3">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row border-bottom">
                            <div class="col-md-5">
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-4 col-form-label pt-1">
                                        Job Number * :
                                    </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 90%;">
                                            <input type="text" matInput
                                                formControlName="jobNumber"
                                                id="jobNumbercode" tabindex="1"
                                                (focusout)="jobNumberValidate($event)"
                                                [readonly]="viewMode"
                                                (keydown)="lookupKeyPress($event,'jobNumber')" />
                                            <mat-error *ngIf="metalIssueDetailsForm.controls.jobNumber.touched 
                                                && metalIssueDetailsForm.controls.jobNumber.hasError('required')">
                                                Job number required
                                            </mat-error>
                                            <master-search class="masterSearch"
                                                [MasterSearchData]="jobNumberCodeData"
                                                #overlayjobNumDes
                                                (newRowClick)="jobNumberCodeSelected($event)"
                                                *ngIf="!viewMode">
                                            </master-search>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-5">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput
                                                formControlName="jobNumDes"
                                                readonly />

                                        </mat-form-field>

                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-4 col-form-label">Sub Job
                                        No : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 90%;">
                                            <input type="text" matInput
                                                tabindex="2"
                                                formControlName="subJobNo"
                                                (keydown)="lookupKeyPress($event,'subJobNo')"
                                                (change)="subJobNumberChange($event)"
                                                [readonly]="viewMode" />
                                            <master-search class="masterSearch"
                                                *ngIf="!viewMode"
                                                #subJobNoCodeOverlay
                                                [MasterSearchData]="subJobNoCodeData"
                                                (newRowClick)="subJobNoCodeSelected($event)"></master-search>
                                        </mat-form-field>

                                    </div>
                                    <div class="col-md-5">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput
                                                formControlName="subJobNoDes"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-4 col-form-label">
                                        Process Code * :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 90%;">
                                            <input type="text" matInput
                                                UpperCaseDirective tabindex="3"
                                                formControlName="processCode"
                                                [readonly]="viewMode"
                                                (keydown)="lookupKeyPress($event,'processCode')"
                                                (change)="processCodeValidate($event)" />
                                            <master-search class="masterSearch"
                                                [MasterSearchData]="processCodeData"
                                                #overlayprocessCode
                                                (newRowClick)="processCodeSelected($event)"
                                                *ngIf="!viewMode">
                                            </master-search>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-5">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput
                                                formControlName="processCodeDesc"
                                                readonly>
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-4 col-form-label">
                                        Worker Code * : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 90%;">
                                            <input type="text" matInput
                                                UpperCaseDirective
                                                formControlName="workerCode"
                                                tabindex="4"
                                                (keydown)="lookupKeyPress($event,'workerCode')"
                                                [readonly]="viewMode"
                                                (focusout)="WorkerCodeValidate($event)" />
                                            <master-search class="masterSearch"
                                                [MasterSearchData]="workerCodeData"
                                                #overlayworkerCodeDes
                                                (newRowClick)="workerCodeSelected($event)"
                                                *ngIf="!viewMode"></master-search>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-5">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput readonly
                                                formControlName="workerCodeDes" />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="row mb-1">
                                    <label class="col-sm-12 col-form-label">
                                        Design</label>
                                    <div class="col-md-12  mb-1">
                                        <div class="upload-btn-wrapper">
                                            <div
                                                class="row  d-flex justify-content-center">
                                                <div class="square-box">
                                                    <image-slider
                                                        [imageArray]="imagepath"></image-slider>
                                                </div>
                                            </div>
                                            <!-- <button
                                                class="btn btnnew border-dark">
                                                <img src={{image}}
                                                    style="width:100%;height:124px">

                                            </button> -->
                                            <!-- <input type="file"
                                                class="uploadproduct"
                                                accept=".png, .jpg, .jpeg"
                                                #fileInput
                                                (change)="onFileChangedimage($event)"> -->
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput
                                                formControlName="DESIGN_CODE"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                    <!--<div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <mat-form-field appearance="outline"
                                                    style="width: 100%;">
                                                    <input type="text" matInput
                                                        formControlName="UNQ_DESIGN_ID"
                                                        [readonly]="viewMode" />
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-12">
                                                <mat-form-field appearance="outline"
                                                    style="width: 100%;">
                                                    <input type="text" matInput
                                                        formControlName="pictureName"
                                                        [readonly]="viewMode" />
                                                </mat-form-field>
                                            </div>
                                        </div> 
                                    </div>-->
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-4 col-form-label">Part
                                        ID</label>
                                    <div class="col-md-12 mb-1">
                                        <div class="upload-btn-wrapper">
                                            <div
                                                class="row  d-flex justify-content-center">
                                                <div class="square-box">
                                                    <image-slider
                                                        [imageArray]="Partimagepath"></image-slider>
                                                </div>
                                            </div>
                                            <!-- <button
                                                class="btn btnnew border-dark">
                                                <img src={{urls}}
                                                    style="width:100%;height:124px">

                                            </button> -->
                                            <!-- <input type="file"
                                                class="uploadproduct"
                                                accept=".png, .jpg, .jpeg"
                                                #fileInput
                                                (change)="onFileChanged($event)"> -->
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <mat-form-field appearance="outline"
                                            style="width: 80%;">
                                            <input type="text" matInput
                                                formControlName="PART_CODE"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row my-2">
                            <div class="col-md-6">
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Tree
                                        Number :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="treeNumber"
                                                [readonly]="viewMode"
                                                maxlength="15"
                                                class="text-right"
                                                class="text-right" NumberOnly />
                                        </mat-form-field>
                                    </div>
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Job
                                        Purity :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="jobPurity"
                                                class="text-right"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">
                                        Stock Code * :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 60%;">
                                            <input type="text" matInput
                                                formControlName="DIVCODE"
                                                placeholder="Div Code" UpperCaseDirective
                                                [readonly]="viewMode"
                                                (focusout)="validateLookupField($event,divCodeData,'DIVCODE')" />
                                            <master-search class="masterSearch"
                                                *ngIf="!viewMode"
                                                [MasterSearchData]="divCodeData"
                                                (newRowClick)="divCodeSelected($event)">
                                            </master-search>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-6">

                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="stockCode"
                                                UpperCaseDirective tabindex="5"
                                                placeholder="Stock Code"
                                                (focusout)="stockCodeValidate($event)"
                                                [readonly]="viewMode"
                                                (keydown)="lookupKeyPress($event,'stockCode')" />
                                            <master-search class="masterSearch"
                                                *ngIf="!viewMode"
                                                [MasterSearchData]="stockCodeData"
                                                #overlaystockcode
                                                (newRowClick)="stockCodeSelected($event)"></master-search>
                                        </mat-form-field>

                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Pcs
                                        :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="pcs"
                                                [readonly]="viewMode"
                                                maxlength="10"
                                                style="text-align: right;"
                                                NumberOnly />
                                        </mat-form-field>
                                    </div>
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Purity :
                                    </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="number" matInput
                                                formControlName="PURITY"
                                                readonly
                                                class="text-right"
                                                PurityDecimal />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Gross
                                        Weight :</label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="GROSS_WT"
                                                [readonly]="viewMode"
                                                (focusout)="grossValidate()"
                                                MetalDecimalInput [max]="13"
                                                class="text-right" />
                                        </mat-form-field>
                                    </div>
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Net
                                        Weight : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="NET_WT"
                                                readonly
                                                class="text-right"
                                                MetalDecimalInput [max]="13" />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Stone
                                        Weight : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="STONE_WT"
                                                [readonly]="viewMode"
                                                class="text-right"
                                                (focusout)="stoneValidate()"
                                                StoneDecimalInput
                                                [max]="13" />
                                        </mat-form-field>
                                    </div>
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Pure
                                        Weight : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="PURE_WT"
                                                readonly
                                                class="text-right"
                                                MetalDecimalInput [max]="13" />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">To Stock
                                        Code : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 60%;">
                                            <input type="text" matInput 
                                                formControlName="toDIVCODE"  UpperCaseDirective
                                                placeholder="Div Code"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-6">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="toStockCode"
                                                placeholder="Stock Code" UpperCaseDirective
                                                (focusout)="toStockCodeValidate($event)"
                                                [readonly]="viewMode"
                                                (keydown)="lookupKeyPress($event,'stockCode')" />
                                            <master-search class="masterSearch"
                                                [MasterSearchData]="toStockCodeData"
                                                #overlayTostockcode
                                                (newRowClick)="toStockCodeSelected($event)"
                                                *ngIf="!masterMetalChecked"></master-search>
                                        </mat-form-field>
                                    </div>
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Location
                                        * : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 70%;">
                                            <input type="text" matInput
                                                formControlName="location"
                                                [readonly]="viewMode"
                                                UpperCaseDirective
                                                (keydown)="lookupKeyPress($event,'location')"
                                                (focusout)="validateLookupField($event,locationCodeData,'location')" />
                                            <master-search class="masterSearch"
                                                [MasterSearchData]="locationCodeData"
                                                #overlaylocation
                                                (newRowClick)="locationCodeSelected($event)"
                                                *ngIf="!viewMode"></master-search>
                                        </mat-form-field>

                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <div class="col-md-6">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="stockCodeDes"
                                                placeholder="Description"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Purity
                                        Diff : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="number" matInput
                                                formControlName="purityDiff"
                                                readonly
                                                class="text-right"
                                                MetalDecimalInput />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="inputPassword"
                                        class="col-sm-3 col-form-label">Job Pcs
                                        : </label>
                                    <div class="col-md-3">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="JOB_PCS"
                                                readonly
                                                class="text-right" NumberOnly />
                                        </mat-form-field>
                                    </div>
                                    <!-- <div class="col-md-3 offset-3">
                                        <mat-form-field appearance="outline" style="width: 100%;">
                                            <input type="number" matInput
                                                formControlName="amountLc"
                                                [readonly]="viewMode"
                                                style="text-align: right;"
                                                AmountDecimalInput />
                                        </mat-form-field>
                                    </div> -->
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                type="checkbox"
                                                [readonly]="viewMode"
                                                (change)="masterMetalChange($event)"
                                                formControlName="masterMetal">
                                            <label class="form-check-label"
                                                for="DesighCode">
                                                Master Metal
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <mat-form-field appearance="outline"
                                            style="width: 100%;">
                                            <input type="text" matInput
                                                formControlName="toStockCodeDes"
                                                placeholder="Description"
                                                readonly />
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row my-2">
                    <div class="col-md-12">
                        <dx-data-grid #dataGrid id="gridContainer"
                            [showBorders]="true" [dataSource]="tableData"
                            [allowColumnReordering]="true"
                            [allowColumnResizing]="true"
                            [columnAutoWidth]="true">
                            <dxo-paging [enabled]="false"></dxo-paging>
                            <dxo-editing mode="cell" [allowUpdating]="true">
                            </dxo-editing>
                            <dxo-selection mode="single"></dxo-selection>
                            <dxo-scrolling mode="virtual"></dxo-scrolling>

                            <!-- <dxi-column *ngFor="let data of columnhead" dataField="{{ data }}" caption="{{ data }}"
                                [allowEditing]="true" alignment="center" backgroundcolor="#000">
                            </dxi-column> -->
                            <dxi-column [allowEditing]="false"
                                dataField="DIVCODE" alignment="left"
                                caption="DIVCODE"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="STOCK_CODE" alignment="left"
                                caption="STOCK_CODE"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="KARAT_CODE" alignment="left"
                                caption="KARAT"></dxi-column>
                            <dxi-column [allowEditing]="false" dataField="COLOR"
                                caption="COLOR" alignment="left"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="MTL_PCS" alignment="right"
                                caption="MTL_PCS"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="MTL_WT" alignment="right"
                                caption="MTL_WT"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="ISS_MTL_PCS" alignment="right"
                                caption="ISS_MTL_PCS"></dxi-column>
                            <dxi-column [allowEditing]="false"
                                dataField="ISS_MTL_WT" alignment="right"
                                caption="ISS_MTL_WT"></dxi-column>
                            <dxi-column dataField="BAL_MTL_PCS"
                                alignment="right"
                                caption="BAL_MTL_PCS"></dxi-column>
                            <dxi-column dataField="BAL_MTL_WT" alignment="right"
                                caption="BAL_MTL_WT"></dxi-column>
                        </dx-data-grid>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
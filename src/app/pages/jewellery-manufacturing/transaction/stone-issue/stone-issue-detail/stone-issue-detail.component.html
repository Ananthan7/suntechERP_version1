<!-- header section starts -->
<div class="card-content border-bottom d-flex justify-content-between p-2">
  <h5 class="pos-modaltitle" id="modal-dia-metal">Stone Issue Details</h5>
  <button type="button" class="btn btn-close close-btn" (click)="close()">
    <i class="feather icon-x close-icon"></i>
  </button>
</div>
<!-- modal header component -->
<modal-header (saveClick)="formSubmit('SAVE')" (cancelClick)="close()"
  (changeJobClick)="changeJobClicked()" [isViewChangeJob]="!viewMode"
  [isViewSave]="!viewMode" [isViewContinue]="!viewMode"
  (continueClick)="formSubmit('CONTINUE')" (SaveGridDataClick)="SaveGridData()"
  [isViewDelete]="false" [isViewSaveGridData]="!viewMode"
  [isViewMore]="false"></modal-header>

<div class="p-3">
  <form [formGroup]="stoneIssueDetailsFrom">
    <div class="row">
      <div class="col-md-8 border-bottom">
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Job Number
            * : </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="jobNumber"
                [readonly]="viewMode" UpperCaseDirective
                (focusout)="jobNumberValidate($event)" (keyup)="codeEnabled()"
                (keydown)="lookupKeyPress($event,'jobNumber')"
                #jobNumberInput />
              <master-search class="masterSearch"
                [MasterSearchData]="jobNumberCodeData" #overlayjobNumberSearch
                (newRowClick)="jobNumberCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>

          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="jobDes" readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Sub Job No
            * : </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="subjobnumber"
                [readonly]="viewMode || codeEnable" UpperCaseDirective
                (focusout)="validateLookupField($event,subJobNoCodeData,'subjobnumber')" 
                (keydown)="lookupKeyPress($event,'subjobnumber')" />
              <master-search class="masterSearch"
                [MasterSearchData]="subJobNoCodeData" #overlaysubjobnoSearch
                (newRowClick)="subJobNoCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="subjobDes"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Design
            Code: </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="DESIGN_CODE"
                readonly />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-2 col-form-label">Part Code:
          </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="PART_CODE"
                readonly />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-2 col-form-label">Salesorder
            No: </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="salesorderno"
                class="text-left" readonly />
            </mat-form-field>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Process * :
          </label>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="process" maxlength="7"
                UpperCaseDirective
                (focusout)="SPvalidateLookupField($event,processCodeData,'process')"
                (keydown)="lookupKeyPress($event,'process')"
                [readonly]="viewMode || codeEnable" />
              <master-search class="masterSearch"
                [MasterSearchData]="processCodeData" #overlayprocessSearch
                (newRowClick)="processCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>

          </div>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="processname"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Worker * :
          </label>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="worker"
                [readonly]="viewMode || codeEnable" UpperCaseDirective
                (focusout)="SPvalidateLookupField($event,workerCodeData,'worker')"
                (keydown)="lookupKeyPress($event,'worker')" />
              <master-search class="masterSearch"
                [MasterSearchData]="workerCodeData" #overlayworkerSearch
                (newRowClick)="workerCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>

          </div>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="workername"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Stock * :
          </label>
          <div class="col-md-2">
            <mat-form-field appearance="outline" style="width: 80px;">
              <input type="text" matInput formControlName="DIVCODE"
                placeholder="Div Code" [readonly]="viewMode || codeEnable"
                (focusout)="divisionCodeValidate($event)" maxlength="1"
                (keydown)="lookupKeyPress($event,'DIVCODE')"
                (blur)="validateManualEntry($event)"
                UpperCaseDirective />
              <master-search class="masterSearch"
                [MasterSearchData]="divCodeData" #overlayDivCodeSearch
                (newRowClick)="divCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline"
              style="width: 284px;; margin-left: -70px;">
              <input type="text" matInput formControlName="stockCode"
                placeholder="Stock Code" maxlength="16"
                (focusout)="stockCodeValidate($event)" UpperCaseDirective
                (keydown)="lookupKeyPress($event,'stockCode')"
                [readonly]="viewMode || codeEnable" />
              <master-search class="masterSearch"
                [MasterSearchData]="stockCodeData" #overlaystockCodeSearch
                (newRowClick)="stockCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>

          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" style="width: 127%;">
              <input type="text" matInput formControlName="stockCodeDes"
                placeholder="Description"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Batch ID :
          </label>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="batchid"
                [readonly]="viewMode || codeEnable" />
            </mat-form-field>
          </div>
          <div class="col-sm-4 mt-3">
            <mat-checkbox class="example-margin" [disabled]="viewMode"
              formControlName="consignment">Consignment</mat-checkbox>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-2 col-form-label">Location *
            : </label>
          <div class="col-md-5">
            <mat-form-field appearance="outline" style="width: 90%;">
              <input type="text" matInput formControlName="Location"
                (keydown)="lookupKeyPress($event,'Location')"
                UpperCaseDirective
                (focusout)="validateLookupField($event,locationCodeData,'Location')"
                [readonly]="viewMode || codeEnable" />
              <master-search class="masterSearch"
                [MasterSearchData]="locationCodeData" #overlaylocationSearch
                (newRowClick)="locationCodeSelected($event)"
                *ngIf="!viewMode"></master-search>
            </mat-form-field>

          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="upload-btn-wrapper mt-2">
          <div class="square-box">
            <image-slider [imageArray]="imagepath"></image-slider>
          </div>
          <!-- <input type="file" name="uploadproduct" accept=".png, .jpg, .jpeg"
            #fileInput class="uploadproduct" (change)="onFileChanged($event)"> -->
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-10 border-top">
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Pieces :
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="pieces"
              maxlength="12"  class="text-right" NumberOnly
                (focusout)="CalculatePiecesAndPointerWT()"
                [readonly]="viewMode || codeEnable" />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Shape :
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="shape" readonly />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Clarity:
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="clarity" readonly
                maxlength="12" />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Carat * :
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="number" matInput formControlName="carat"
                MetalDecimalInput maxlength="15" id="carat"
                (focusout)="CalculateCaratAndUnitrate()"
                style="text-align: right;"
                [readonly]="viewMode || codeEnable" />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Size:
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="size" readonly />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Sieve Set :
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="SIEVE_SET"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Unit
            Rate:</label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="unitrate"
                AmountDecimalInput readonly class="text-right"
                (focusout)="CalculateCaratAndUnitrate()" maxlength="12"/>
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Sieve:
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="sieve" maxlength="12"
                readonly />
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="SIEVE_DESC"
                maxlength="40" readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Amount:
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="amount"
                AmountDecimalInput readonly
                style="text-align: right;" maxlength="12" />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Color:
          </label>
          <div class="col-md-3">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="color" readonly
                maxlength="12" />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Stock Bal:
          </label>
          <div class="col-md-1">
            <mat-form-field appearance="outline" style="width: 80%;">
              <input type="text" matInput formControlName="stockbal"
                maxlength="12" class="text-right" NumberOnly MetalDecimalInput
                readonly />
            </mat-form-field>
          </div>
          <label for="inputPassword" class="col-sm-1 col-form-label">Pointer Wt:
          </label>
          <div class="col-md-1">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="number" matInput formControlName="pointerwt"
                (focusout)="CalculatePiecesAndPointerWT()"
                maxlength="12" FourDecimalInput
                style="text-align: right;"
                readonly />
            </mat-form-field>
          </div>
        </div>
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Other Attr
            : </label>
          <div class="col-md-6">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="otheratt"
                maxlength="20" [readonly]="viewMode || codeEnable" />
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="col-md-10 border-top">
        <div class="row mb-1">
          <label for="inputPassword" class="col-sm-1 col-form-label">Remarks :
          </label>
          <div class="col-md-10">
            <mat-form-field appearance="outline" style="width: 100%;">
              <input type="text" matInput formControlName="remarks"
                maxlength="40" [readonly]="viewMode || codeEnable" />
            </mat-form-field>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <dx-data-grid #dataGrid id="gridContainer" [showBorders]="true"
          [showRowLines]="true"
          [dataSource]="tableData" [allowColumnReordering]="true"
          [columnAutoWidth]="true">
          <dxo-paging [enabled]="true" [pageSize]="5"></dxo-paging>
          <dxo-editing mode="cell" [allowUpdating]="true">
          </dxo-editing>
          <dxo-selection mode="single"></dxo-selection>
          <!-- <dxo-scrolling mode="virtual"></dxo-scrolling> -->
          <!-- 
          <dxi-column *ngFor="let data of columnhead1" dataField="{{ data }}"
            caption="{{ data }}" [allowEditing]="true"
            alignment="center" backgroundcolor="#000">
          </dxi-column> -->
          <dxi-column [allowEditing]="false" dataField="DIVCODE"
            caption="DIVCODE" cellTemplate="DivCodetemp"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="STOCK_CODE"
            caption="Stock Code" cellTemplate="StockCodetemp"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SUB_STOCK_CODE"
            caption="Batch ID"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SUB_STOCK_CODE"
            caption="Stock Bal"></dxi-column>
          <dxi-column [allowEditing]="true" dataField="PCS" caption="Pcs"
            [editorOptions]="pcsEditorOptions">
          </dxi-column>
          <dxi-column [allowEditing]="true" dataField="CARATWT_TO"
            caption="Carat" dataType="number"
            [editorOptions]="CaratEditorOptions">
          </dxi-column>
          <dxi-column [allowEditing]="false" dataField="LOCTYPE_CODE"
            caption="Location" cellTemplate="locationCodetemp"></dxi-column>
          <dxi-column [allowEditing]="true" dataField="CONSIGNMENT"
            caption="Consignment" cellTemplate="Consignment">
            <div *dxTemplate="let data1 of 'Consignment'">
              <input type="checkbox"
                [checked]="data1.value" />
            </div>></dxi-column>
          <dxi-column dataField="RATEFC" [allowEditing]="false"
            caption="Rate"
            [format]="{ type: 'fixedPoint', precision: 3 }"></dxi-column>
          <dxi-column dataField="AMOUNTFC" [allowEditing]="false"
            caption="Amount"
            [format]="{ type: 'fixedPoint', precision: 2 }"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="OTHER_ATTR"
            caption="Other Attributes"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SHAPE"
            caption="Shape"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="COLOR"
            caption="Color"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="CLARITY"
            caption="Clarity"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SIZE"
            caption="Size"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SIEVE_SET"
            caption="Sieve Set"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="SIEVE_DESC"
            caption="Sieve Desc"></dxi-column>
          <dxi-column [allowEditing]="true" dataField="D_REMARKS"
            caption="Remarks"
            [editorOptions]="RemarkEditorOptions"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="ISS_STN_PCS"
            caption="Issued Pcs"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="ISS_STN_WT"
            caption="Issued Wt"
            [format]="{ type: 'fixedPoint', precision: 3 }"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="BAL_STN_PCS"
            caption="Bal Pcs"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="BAL_STN_WT"
            caption="Bal Wt"
            [format]="{ type: 'fixedPoint', precision: 3 }"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="POINTER_WT"
            caption="Pointer Wt"
            [format]="{ type: 'fixedPoint', precision: 3 }"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="PCS_VARIANCE"
            caption="Pcs Variance"></dxi-column>
          <dxi-column [allowEditing]="false" dataField="WEIGHT_VARIANCE"
            caption="Weight Variance"></dxi-column>
          <div *dxTemplate="let data of 'DivCodetemp'">
            <a href="javascript:void(0)" class="mx-1"
              [innerHTML]="data.value"></a>
            <master-search [MasterSearchData]="divCodeData"
              (newRowClick)="GriddivCodeSelected($event,data,'DivCodetemp')">
            </master-search>
          </div>
          <div *dxTemplate="let data of 'StockCodetemp'">
            <a href="javascript:void(0)" class="mx-1"
              [innerHTML]="data.value"></a>
            <master-search [MasterSearchData]="stockCodeData"
              (newRowClick)="GridstockCodeSelected($event,data,'StockCodetemp')">
            </master-search>
          </div>
          <div *dxTemplate="let data of 'locationCodetemp'">
            <a href="javascript:void(0)" class="mx-1"
              [innerHTML]="data.value"></a>
            <master-search [MasterSearchData]="locationCodeData"
              (newRowClick)="GridlocationCodeSelected($event,data,'locationCodetemp')">
            </master-search>
          </div>
        </dx-data-grid>
      </div>
    </div>
  </form>
</div>
<header-panel [selectedTemplate]="savedTemplateDatas"></header-panel>
<!-- common filter -->
<master-filter (refreshData)="refreshBtnClick()"
    (filterData)="dataToFilter($event)"
    (exportExcel)="exportbtnClick()" (exportPDF)="exportPdf()"></master-filter>
    <div class="col-md-2">
        <ng-select
          class="text-start"
          [items]="yearData"
          bindLabel="value"
          bindValue="value"
          [(ngModel)]="yearFiltered"
          (change)="yearFilterChange($event)"
        >
        </ng-select>
      </div>
<app-loader [isLoading]="isLoading"></app-loader>
<!-- content -->
<div class="row mt-3 d-flex justify-content-center" *ngIf="!isChartSelected"
    #content id="content">
    <div class="card slips p-3 d-flex flex-column">
        <span class="graphheader">Revenue</span>
        <div>
            <span class="card-num"
                [ngStyle]="{'color': model.revenueColor ? '#00a561' : 'red'}">
                {{model.sumOfrevenue | numberFormatter}}
                <i class="fas fa-caret-up" *ngIf="model.revenueColor"></i>
                <i class="fas fa-caret-down" *ngIf="!model.revenueColor"></i>
            </span> <br>
        </div>
        <div class="d-flex justify-content-end" style="color: #336699;">
            CY Target
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY</span> <br>
                <span class="inner-num">{{model.sumOfPYrevenue |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY Target</span> <br>
                <span class="inner-num">{{model.sumOfCYrevTarget |
                    numberFormatter}}</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY Target</span> <br>
                <span class="inner-num">{{model.sumOfPY_revTarget |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY :
                    {{model.sumOfCYrevTargetPerc}}%</span>
                <ngb-progressbar [showValue]="true"
                    [value]="model.sumOfCYrevTargetPerc"
                    style="border-radius: 2rem"></ngb-progressbar>
                <span class="dark-font-color">PY :
                    {{model.sumOfPYrevTargetPerc}}%</span>
                <ngb-progressbar [showValue]="true"
                    [value]="model.sumOfPYrevTargetPerc"
                    style="border-radius: 2rem"></ngb-progressbar>
            </div>
        </div>
    </div>
    <!-- grossmargin -->
    <div class="card slips p-3 ms-2 d-flex flex-column">
        <span class="graphheader">Gross Margin</span>
        <div>
            <span class="card-num"
                [ngStyle]="{'color': model.GMPercColor ? '#00a561' : 'red'}">
                {{model.sumOfgrossMargin | numberFormatter}}
                <i class="fas fa-caret-up" *ngIf="model.GMPercColor"></i>
                <i class="fas fa-caret-down" *ngIf="!model.GMPercColor"></i>
            </span> <br>
        </div>
        <div class="d-flex justify-content-end" style="color: #336699;">
            CY Target
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY</span> <br>
                <span class="inner-num">{{model.sumOfPYgrossMargin |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY Target</span> <br>
                <span class="inner-num">{{model.sumOfCYgrossMarginTarget |
                    numberFormatter}}</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY Target</span> <br>
                <span class="inner-num">{{model.sumOfPYgrossMarginTarget |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
                <span class="dark-font-color">PY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
            </div>
        </div>
    </div>
    <div class="card slips p-3 ms-2 d-flex flex-column">
        <span class="graphheader">Gross Margin %</span>
        <div>
            <span class="card-num"
                [ngStyle]="{'color': (model.PYGMpercentage < model.GMpercentage) ? '#00a561' : '#F14336'}">
                {{model.GMpercentage | numberFormatter}}%
                <i class="fas fa-caret-up"
                    *ngIf="model.PYGMpercentage < model.GMpercentage"></i>
                <i class="fas fa-caret-down"
                    *ngIf="model.PYGMpercentage > model.GMpercentage"></i>
            </span> <br>
        </div>
        <div class="d-flex justify-content-end" style="color: #336699;">
            CY Target
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY</span> <br>
                <span class="inner-num">{{model.PYGMpercentage |
                    numberFormatter}}%</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY Target</span> <br>
                <span class="inner-num">{{model.CYGMpercentageTGT |
                    numberFormatter}}%</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY Target</span> <br>
                <span class="inner-num">{{model.PYGMpercentageTGT |
                    numberFormatter}}%</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
                <span class="dark-font-color">PY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
            </div>
        </div>
    </div>
    <div class="card slips p-3 ms-2 d-flex flex-column">
        <span class="graphheader">Quantity Sold</span>
        <div>
            <span class="card-num"
                [ngStyle]="{'color': model.QtySoldColor ? '#00a561' : '#F14336'}">
                {{model.sumOfQtySold | numberFormatter}}
                <i class="fas fa-caret-up" *ngIf="model.QtySoldColor"></i>
                <i class="fas fa-caret-down" *ngIf="!model.QtySoldColor"></i>
            </span> <br>
        </div>
        <div class="d-flex justify-content-end" style="color: #336699;">
            CY Target
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY</span> <br>
                <span class="inner-num">{{model.sumOfPY_QtySold |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY Target</span> <br>
                <span class="inner-num">{{model.sumOfCY_QtySoldTarget |
                    numberFormatter}}</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY Target</span> <br>
                <span class="inner-num">{{model.sumOfPY_QtySoldTarget |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
                <span class="dark-font-color">PY</span>
                <ngb-progressbar [showValue]="true" [value]="100"
                    style="border-radius: 2rem"></ngb-progressbar>
            </div>
        </div>
    </div>
    <div class="card slips p-3 ms-2 d-flex flex-column">
        <span class="graphheader">COGS</span>
        <div>
            <span class="card-num"
                [ngStyle]="{'color': model.cogsColor ? '#00a561' : '#F14336'}">
                {{model.sumOfCOGS | numberFormatter}}
                <i class="fas fa-caret-up" *ngIf="model.cogsColor"></i>
                <i class="fas fa-caret-down" *ngIf="!model.cogsColor"></i>
            </span> <br>
        </div>
        <div class="d-flex justify-content-end" style="color: #336699;">
            CY Target
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY</span> <br>
                <span class="inner-num">{{model.sumOfPY_COGSArray |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY Target</span> <br>
                <span class="inner-num">{{model.sumOfCY_COGSTarget |
                    numberFormatter}}</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="dark-font-color">PY Target</span> <br>
                <span class="inner-num">{{model.sumOfPY_COGSTarget |
                    numberFormatter}}</span>
            </div>
            <div class="col-md-6">
                <span class="dark-font-color">CY</span>
                <ngb-progressbar [showValue]="true" [value]="60"
                    style="border-radius: 2rem"></ngb-progressbar>
                <span class="dark-font-color">PY</span>
                <ngb-progressbar [showValue]="true" [value]="60"
                    style="border-radius: 2rem"></ngb-progressbar>
            </div>
        </div>
    </div>
</div>
<!-- table section -->
<div class="row mt-3 ps-1 d-flex">
    <div class="col-md-12 col-sm-12">
        <h5>Revenue</h5>
        <!-- <dx-data-grid id="gridContainer" [dataSource]="branchResults"
            [remoteOperations]="false"
            [allowColumnReordering]="true" [rowAlternationEnabled]="true"
            [showBorders]="true">
            <dxo-paging [pageSize]="10"></dxo-paging>
            <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[10, 25, 50, 100]"></dxo-pager> 
            <dxo-group-panel [visible]="true"></dxo-group-panel>
            <dxo-grouping [autoExpandAll]="false"></dxo-grouping>

            <dxi-column dataField="BRANCH" groupCellTemplate="groupCellTemplate"
                [groupIndex]="0"></dxi-column>

            <dxi-column dataField="REVENUE" [customizeText]="customizeText"
                caption="Revenue"> </dxi-column>
            <dxi-column dataField="PY_REVENUE" [customizeText]="customizeText"
                caption="Previous Year Revenue"> </dxi-column>
            <dxi-column dataField="GROSS_MARGIN" [customizeText]="customizeText"
                caption="Gross Margin"> </dxi-column>
            <dxi-column dataField="PY_GROSS_MARGIN"
                [customizeText]="customizeText"
                caption="Previous Year Gross Margin"> </dxi-column>
            <dxi-column dataField="QUANTITY_SOLD" caption="Quantity">
            </dxi-column>
            <dxi-column dataField="PY_QUANTITY_SOLD"
                caption="Previous Year Quantity"> </dxi-column>
            <dxi-column dataField="COGS" [customizeText]="customizeText"
                caption="COGS"> </dxi-column>
            <dxi-column dataField="PY_COGS" [customizeText]="customizeText"
                caption="Previous Year COGS"> </dxi-column>
            <dxo-scrolling columnRenderingMode="virtual"></dxo-scrolling>
            <div *dxTemplate="let cell of 'groupCellTemplate'">
                <div>{{cell.value}}</div>
            </div>
            <dxo-summary>
                <dxi-total-item column="BRANCH" displayFormat="Total"></dxi-total-item>
                <dxi-total-item column="REVENUE" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_REVENUE"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="GROSS_MARGIN"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_GROSS_MARGIN"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="QUANTITY_SOLD"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_QUANTITY_SOLD"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="COGS" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_COGS" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
            </dxo-summary>
        </dx-data-grid> -->
        <dx-data-grid id="gridContainer" [dataSource]="branchResults"
            [showBorders]="true" class="mt-3"
            [columnAutoWidth]="true" [showRowLines]="true"
            [showColumnLines]="false" [rowAlternationEnabled]="true">
            <dxi-column dataField="BRANCH" caption="Branch"> </dxi-column>
            <dxi-column dataField="REVENUE" [customizeText]="customizeText"
                caption="Revenue"> </dxi-column>
            <dxi-column dataField="PY_REVENUE" [customizeText]="customizeText"
                caption="Previous Year Revenue"> </dxi-column>
            <dxi-column dataField="GROSS_MARGIN" [customizeText]="customizeText"
                caption="Gross Margin"> </dxi-column>
            <dxi-column dataField="PY_GROSS_MARGIN"
                [customizeText]="customizeText"
                caption="Previous Year Gross Margin"> </dxi-column>
            <dxi-column dataField="QUANTITY_SOLD" [customizeText]="customizeText" caption="Quantity">
            </dxi-column>
            <dxi-column dataField="PY_QUANTITY_SOLD" [customizeText]="customizeText"
                caption="Previous Year Quantity"> </dxi-column>
            <dxi-column dataField="COGS" [customizeText]="customizeText"
                caption="COGS"> </dxi-column>
            <dxi-column dataField="PY_COGS" [customizeText]="customizeText"
                caption="Previous Year COGS"> </dxi-column>
            <dxo-scrolling columnRenderingMode="virtual"></dxo-scrolling>
            <dxo-summary>
                <dxi-total-item column="BRANCH" displayFormat="Total"></dxi-total-item>
                <dxi-total-item column="REVENUE" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_REVENUE"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="GROSS_MARGIN"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_GROSS_MARGIN"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="QUANTITY_SOLD"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_QUANTITY_SOLD"
                    [customizeText]="customizeText" summaryType="sum"
                    displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="COGS" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
                <dxi-total-item column="PY_COGS" [customizeText]="customizeText"
                    summaryType="sum" displayFormat="{0}"></dxi-total-item>
            </dxo-summary>
        </dx-data-grid>
    </div>
</div>
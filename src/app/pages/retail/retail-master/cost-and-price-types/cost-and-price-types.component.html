<!-- header section starts -->
<div class="card-content border-bottom d-flex justify-content-between p-2">
  <h5 class="pos-modaltitle" id="modal-dia-metal">Cost And Price Types</h5>
  <button type="button" class="btn btn-close close-btn" (click)="close()">
    <i class="feather icon-x close-icon"></i>
  </button>
</div>

<!-- modal header component -->
<modal-header
[isViewMore]="this.flag !== 'VIEW'"
  (saveClick)="costAndPriceTypeMainFormSubmit()"
  (cancelClick)="close()"
  (deleteClick)="DeleteController()"
  [isViewDelete]="false"
  [isViewCancel]="!['VIEW', 'DELETE'].includes(flag)"
  [isViewSave]="!['VIEW', 'DELETE'].includes(flag)"
></modal-header>

<!-- content section -->
<div class="container-fluid pt-3">
  <form [formGroup]="costAndPriceTypeMainForm">
    <div class="row mt-2">
      <div class="col-md-12">
        <div class="row">
          <h4 class="mt-2 mb-4">Header Details</h4>
          <div class="col-md-6">
            <div class="row mb-1">
              <label for="code" class="col-sm-2 col-form-label" id="ID029"
                >Code</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <input
                    [readonly]="flag === 'VIEW' || flag === 'EDIT'"
                    [maxlength]="6"
                    UpperCaseDirective
                    #codeField
                    matInput
                    type="text"
                    formControlName="code"
                  />
                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls['code'].hasError(
                        'required'
                      )
                    "
                  >
                    Code is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label
                for="description"
                class="col-sm-2 col-form-label"
                id="ID029"
                >Description</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <input
                    [readonly]="flag === 'VIEW'"
                    UpperCaseDirective
                    matInput
                    [maxlength]="30"
                    type="text"
                    formControlName="description"
                  />
                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls['description'].hasError(
                        'required'
                      )
                    "
                  >
                    Desc is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label for="party" class="col-sm-2 col-form-label" id="ID029"
                >Party</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <mat-select formControlName="party">
                    <mat-option
                      *ngFor="let data of partyDropdown"
                      [value]="data.VALUE"
                    >
                      {{ data.FIELD }}
                    </mat-option>
                  </mat-select>

                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls['party'].hasError(
                        'required'
                      )
                    "
                  >
                    Party is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label for="division" class="col-sm-2 col-form-label" id="ID029"
                >Division</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <input
                    [readonly]="flag === 'VIEW'"
                    matInput
                    type="text"
                    formControlName="division"
                    UpperCaseDirective
                    (focusout)="
                      SPvalidateLookupFieldModified(
                        $event,
                        divisionCodeData,
                        ['division'],
                        false,
                        ['DIVISION_CODE'],
                        false
                      )
                    "
                  />

                  <master-search
                    (focusout)="openTab($event, 'division')"
                    *ngIf="flag != 'VIEW'"
                    #overlayDivision
                    class="masterSearch"
                    [MasterSearchData]="divisionCodeData"
                    (newRowClick)="
                      lookupSelect($event, ['division'], ['DIVISION_CODE'])
                    "
                  >
                  </master-search>
                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls['division'].hasError(
                        'required'
                      )
                    "
                  >
                    Division is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-md-6">
                <mat-checkbox
                  class="example-margin"
                  formControlName="applyPriceValue"
                  (change)="matBoxChecker($event, 'applyPriceValue')"
                  >Apply Price Value</mat-checkbox
                >
              </div>

              <div class="col-md-6">
                <mat-checkbox
                  class="example-margin"
                  formControlName="forceMaking"
                  (change)="matBoxChecker($event, 'forceMaking')"
                  >Force Making Charges On Net. Wt.</mat-checkbox
                >
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="row mb-1">
              <label
                for="standardPrice"
                class="col-sm-3 col-form-label"
                id="ID029"
                >Standard Price</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <mat-select formControlName="standardPrice">
                    <mat-option
                      *ngFor="let data of stdMaxAndMinPriceDropdown"
                      [value]="data.VALUE"
                    >
                      {{ data.FIELD }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label
                for="minimumPrice"
                class="col-sm-3 col-form-label"
                id="ID029"
                >Minimum Price</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <mat-select formControlName="minimumPrice">
                    <mat-option
                      *ngFor="let data of stdMaxAndMinPriceDropdown"
                      [value]="data.VALUE"
                    >
                      {{ data.FIELD }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label
                for="maximumPrice"
                class="col-sm-3 col-form-label"
                id="ID029"
                >Maximum Price</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <mat-select formControlName="maximumPrice">
                    <mat-option
                      *ngFor="let data of stdMaxAndMinPriceDropdown"
                      [value]="data.VALUE"
                    >
                      {{ data.FIELD }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label
                for="standardVariance"
                class="col-sm-3 col-form-label"
                id="ID029"
                >Standard Variance</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <input
                    [readonly]="flag === 'VIEW'"
                    AmountDecimalInput
                    (change)="addToGrid($event, 'standardVariance')"
                    matInput
                    class="text-right"
                    type="number"
                    formControlName="standardVariance"
                    (keydown)="preventInvalidInput($event)"
                  />

                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls[
                        'standardVariance'
                      ].hasError('required')
                    "
                  >
                    Standard Variance is required.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="row mb-1">
              <label
                for="defaultWastage"
                class="col-sm-3 col-form-label"
                id="ID029"
                >Default Wastage %</label
              >
              <div class="col-md-4">
                <mat-form-field style="width: 100%" appearance="outline">
                  <input
                    [readonly]="flag === 'VIEW'"
                    AmountDecimalInput
                    (change)="addToGrid($event, 'defaultWastage')"
                    matInput
                    class="text-right"
                    type="number"
                    formControlName="defaultWastage"
                    (keydown)="preventInvalidInput($event)"
                  />
                  <mat-error
                    *ngIf="
                      costAndPriceTypeMainForm.controls[
                        'defaultWastage'
                      ].hasError('required')
                    "
                  >
                    Default Wastage % is required.
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-md-4">
                <button
                  [disabled]="flag === 'VIEW'"
                  type="button"
                  (click)="stockMastersData()"
                  class="col-md-12 p-4 mb-4 btn btn-primary text-center"
                >
                  Select Stock Masters
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-4">
          <h4 class="mt-2 mb-4">Item Details</h4>

          <!-- <menu-buttons
            *ngIf="flag !== 'VIEW'"
            [viewAddBtn]="true"
            [viewDeleteBtn]="true"
            [viewImportBtn]="false"
            (addClick)="openItemDetailsRow()"
            (deleteClick)="removeItemDetailsRow()"
          >
          </menu-buttons> -->

          <div class="col-md-12">
            <dx-data-grid
              id="gridContainer"
              [showBorders]="true"
              [dataSource]="itemDetailsData"
              [showColumnLines]="true"
              [showRowLines]="true"
              class="mt-3"
              [paging]="{ pageSize: 5 }"
              [editing]="{ mode: 'cell', allowUpdating: true }"
            >
              <dxo-paging [enabled]="true"></dxo-paging>
              <dxo-pager [showInfo]="true"></dxo-pager>
              <!-- <dxo-selection mode="multiple"></dxo-selection> -->

              <dxi-column
                *ngFor="let data of detailsGridColumnHeadings"
                [dataField]="data.FIELD"
                [caption]="data.CAPTION"
                [allowEditing]="true"
                alignment="center"
              >
                <ng-template dxTemplate="cellTemplate" let-cellData="cellData">
                  <mat-form-field style="width: 100%" appearance="outline">
                    <input
                      [readonly]="flag === 'VIEW'"
                      class="form-control"
                      matInput
                      type="text"
                      [value]="cellData.data[data.FIELD]"
                      placeholder="{{ data.CAPTION }}"
                    />
                  </mat-form-field>
                </ng-template>
              </dxi-column>
            </dx-data-grid>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<!-- header section starts -->
<div class="card-content border-bottom d-flex justify-content-between p-2">
    <h5 class="pos-modaltitle" id="modal-dia-metal"> Customer Enquiry </h5>
    <button type="button" class="btn btn-close close-btn" (click)="close()">
        <i class="feather icon-x close-icon"></i>
    </button>
</div>
<!-- modal header component -->
<modal-header [isViewDelete]="false" [isViewMore]="false" [isViewSave]="false" [editSaveBtnText]="'Go'" 
 [isloading]="isLoading" [isViewCancel]="false"></modal-header>
<!-- content section -->
<div class="container-fluid pt-3 mb-5">
    <form [formGroup]="customerEnquiryForm">
        <div class="row">
            <div class="col-md-6">
                <div class="border border-secondary spacing mb-1">
                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID001">Branch</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="branch" autocomplete="off" formControlName="branch"/>
                                <app-branch-division [fetchData]="fetchedBranchData"
                                (newRowClick)="selectedData($event)" [branchView]="true" [divisionView]="false"
                                [additionalFilterAreaView]="false" [additionalFilterBCategView]="false"
                                class="branchDivisionelectr"
                                [matTooltip]="branchDivisionControlsTooltip"
                                matTooltipClass="custom-tooltip"
                                matTooltipPosition="above"
                                ></app-branch-division>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID002">Name</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="name" autocomplete="off" formControlName="Name"/>
                            </mat-form-field>
                        </div>
                    
                        <!-- <div class="col-md-7 d-flex align-items-center">
                            <app-date (selectedDate)="setDateValue($event)" [dateValue]="dateToPass"></app-date>
                        </div>  -->
                    </div>
    
                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID003">Spouse</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="spouse" autocomplete="off" formControlName="Spouse"/>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID004">Email</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="Email"/>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
        
                <div class="border border-secondary spacing mb-1">
                    <div class="row align-items-center mb-2">
                        <label for="input" id="ID005" class="col-sm-4 col-form-label">Customer</label>
                        <div class="col-sm-4">
                            <mat-form-field style="width: 100%;" appearance="outline">
                                <input type="text" matInput formControlName="customerfrom" maxlength="30"
                                    oninput="this.value = this.value.toUpperCase()" [readonly]="viewMode"
                                    (input)="inputValidate($event)"  />
                                <master-search [MasterSearchData]="customerCodeData" class="masterSearch"
                                    #overlaycustomerSearch *ngIf="viewMode == false"
                                    (newRowClick)="customerCodeSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
                        <div class="col-md-4">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                <input type="text" matInput formControlName="customerto" placeholder="To" />
                            </mat-form-field>
                        </div>
                    </div>   

                    <div class="row mb-2">
                        <label for="inputPassword" class="col-sm-4 col-form-label" id="ID006"
                        style="margin-top: 21px;">Birth Month & Date</label>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <mat-form-field appearance="outline" class="same-width">
                                                <input type="text" matInput formControlName="birthMonth" />
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-2 mx-5">
                                            <mat-form-field appearance="outline" class="same-width mx-2">
                                                <input type="text" matInput formControlName="birthDate"  />
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                        <input matInput [matDatepicker]="bdayPicker1" formControlName="DOBValue" [max]="currentDate"
                                        (dateChange)="onDateChange('bdayPicker1', $event)"/>
                                        <mat-datepicker-toggle matSuffix [for]="bdayPicker1"></mat-datepicker-toggle>
                                        <mat-datepicker #bdayPicker1></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                       
                        <div class="col-md-8 offset-md-4 mb-1">
                            <div class="row" style="margin-top: -16px;">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <mat-form-field appearance="outline" class="same-width">
                                                <input type="text" matInput formControlName="birthMonth2" />
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-2 mx-5">
                                            <mat-form-field appearance="outline" class="same-width mx-2">
                                                <input type="text" matInput formControlName="birthDate2"  />
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                        <input matInput [matDatepicker]="bdayPicker2" formControlName="DOBValue2" [max]="currentDate"
                                        (dateChange)="onDateChange('bdayPicker2', $event)"/>
                                        <mat-datepicker-toggle matSuffix [for]="bdayPicker2"></mat-datepicker-toggle>
                                        <mat-datepicker #bdayPicker2></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label for="inputPassword" class="col-sm-4 col-form-label" id="ID007">Wedding Month</label>

                        <div class="col-md-8" style="margin-bottom: 0.8rem !important;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <mat-form-field appearance="outline" class="same-width">
                                                <input type="text" matInput formControlName="weddingMonth" />
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-2 mx-5">
                                            <mat-form-field appearance="outline" class="same-width mx-2">
                                                <input type="text" matInput formControlName="weddingDate"  />
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                        <input matInput [matDatepicker]="weddingDayPicker1" formControlName="WeddingDateValue" [max]="currentDate"
                                        (dateChange)="onDateChange('weddingDataPicker1', $event)"/>
                                        <mat-datepicker-toggle matSuffix [for]="weddingDayPicker1"></mat-datepicker-toggle>
                                        <mat-datepicker #weddingDayPicker1></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-8 offset-md-4 mb-1">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <mat-form-field appearance="outline" class="same-width">
                                                <input type="text" matInput formControlName="weddingMonth2" />
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-2 mx-5">
                                            <mat-form-field appearance="outline" class="same-width mx-2">
                                                <input type="text" matInput formControlName="WeddingDate2"  />
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                        <input matInput [matDatepicker]="weddingDayPicker2" formControlName="WeddingDateValue2" [max]="currentDate"
                                        (dateChange)="onDateChange('weddingDayPicker2', $event)"/>
                                        <mat-datepicker-toggle matSuffix [for]="weddingDayPicker2"></mat-datepicker-toggle>
                                        <mat-datepicker #weddingDayPicker2></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border border-secondary spacing mb-1">
                    <div class="row align-items-center mb-2">
                        <label for="inputPassword" class="col-sm-4 col-form-label"
                            id="ID008">Contact</label>
                        <div class="col-md-4">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                <input type="text" matInput formControlName="telephoneContact" placeholder="Tele.(Res)" />
                            </mat-form-field>
                        </div>
                        <div class="col-md-4">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                <input type="text" matInput formControlName="mobileContact" placeholder="Mobile" />
                            </mat-form-field>
                        </div>
                    </div>   
                </div>   
                
                <div class="border border-secondary spacing mb-1">
                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID009">Marital St</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <mat-select formControlName="MaritalStatusSelection">
                                    <mat-option *ngFor="let option of maritalStatusArr" [value]="option.value">
                                        {{ option.label }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID010">Gender</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <mat-select formControlName="GenderSelection">
                                    <mat-option value="M">Male</mat-option>
                                    <mat-option value="F">Female</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <label for="inputPassword" id="ID011" class="col-sm-2 col-form-label">Country:</label>
                        <div class="col-md-4">
                            <mat-form-field style="width: 100%;" appearance="outline">
                                <input type="text" matInput formControlName="country"  />
                                <master-search [MasterSearchData]="countryCodeData" class="masterSearch" #overlaycountrySearch
                                (newRowClick)="countryCodeSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID012">Type</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="type"/>
                                <master-search [MasterSearchData]="customerTypeCode" class="masterSearch" #overlaycountrySearch
                                (newRowClick)="customerTypeSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID013">Nationality</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="spouse" autocomplete="off" formControlName="nationality"/>
                                <master-search #overlayNationality [MasterSearchData]="nationalityCode"
                                class="masterSearch" (newRowClick)="nationalitySelected($event)" ></master-search>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID014">Category</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="category"/>
                                <master-search [MasterSearchData]="categoryCodeData" (newRowClick)="categorySelected($event)"
                                class="masterSearch"></master-search>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID015">City</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="spouse" autocomplete="off" formControlName="city"/>
                                <master-search [MasterSearchData]="cityCodeData" (newRowClick)="citySelected($event)"
                                class="masterSearch"></master-search>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID016">Cust</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="cust"/>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID017">Religion</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="spouse" autocomplete="off" formControlName="religion"/>
                                <master-search [MasterSearchData]="religionCode"
                                class="masterSearch" (newRowClick)="religionSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID018">Division</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="division"/>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID019">State</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="spouse" autocomplete="off" formControlName="state"/>
                                <master-search [MasterSearchData]="stateCode" class="masterSearch"
                                (newRowClick)="stateSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID020">Loyalty</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available;">
                                <input matInput="text" name="email" autocomplete="off" formControlName="loyalty"
                                (change)="loyaltyMasterSearch($event)"/>
                                <master-search [MasterSearchData]="LoyaltyMasterFindData" class="masterSearch"
                                (newRowClick)="stateSelected($event)"></master-search>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID021">Sal Date From</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                <input matInput [matDatepicker]="saleDate" formControlName="saleDateFrom" [max]="currentDate"/>
                                <mat-datepicker-toggle matSuffix [for]="saleDate"></mat-datepicker-toggle>
                                <mat-datepicker #saleDate></mat-datepicker>
                            </mat-form-field>
                        </div>
            
                        <div class="col-md-2 d-flex align-items-center">
                            <label for="inputPassword" class="col-form-label" id="ID022">Date To</label>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <mat-form-field appearance="outline" style="width: -webkit-fill-available">
                                <input matInput [matDatepicker]="dateTo" formControlName="dateTo" [max]="currentDate"/>
                                <mat-datepicker-toggle matSuffix [for]="dateTo"></mat-datepicker-toggle>
                                <mat-datepicker #dateTo></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-6">
                <app-loader [isLoading]="isLoading" class="loader-overlay" ></app-loader>
                <dx-data-grid width="100%" height="658px" #gridContainer id="gridContainer" [allowColumnReordering]="true"
                    [dataSource]="GridData" [showColumnLines]="true" [showRowLines]="true"
                    [showBorders]="true" [columnAutoWidth]="true" (onSelectionChanged)="onGridSelection($event)"
                    [selectedRowKeys]="selectedRowKeys" *ngIf="!isLoading">

                    <dxo-filter-row [visible]="showFilterRow"></dxo-filter-row>
                    <dxo-paging [enabled]="false"></dxo-paging>
                    <dxo-editing mode="cell" [allowUpdating]="true"></dxo-editing>
                    <dxo-selection mode="multiple" showCheckBoxesMode="always"></dxo-selection>

                    <dxi-column alignment="left" dataField="CODE" caption="Code" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="NAME" caption="Name" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="MOBILE" caption="Mobile" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="GENDER" caption="Gender" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="NATIONALITY" caption="Nationality" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="CITY" caption="City" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="CITY" caption="State" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="COUNTRY_CODE" caption="Country" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="TYPE" caption="Type" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="CATEGORY" caption="Category" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="DATE_OF_BIRTH" caption="Date Of Birth" [allowResizing]="true" 
                    [customizeText]="customizeDateValue"></dxi-column>
                    <dxi-column alignment="left" dataField="POSSMAN" caption="Sales Man" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="POSCUSTIDNO" caption="Customer ID" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="EMAIL1" caption="Email" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="left" dataField="MARITAL_ST" caption="Marital Status" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="SALAMOUNT" caption="Sales Amount" [allowResizing]="true" 
                    [customizeText]="customizeContent"></dxi-column>
                    <dxi-column alignment="right" dataField="TOTALSALES" caption="Total Sales" [allowResizing]="true" 
                    [customizeText]="customizeContent"></dxi-column>
                    <dxi-column alignment="left" dataField="CUST_TYPE" caption="Customer Type" [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="LAST_UPDATED_DATE" caption="Last Updated Date" [allowResizing]="true" 
                    [customizeText]="customizeDateValue"></dxi-column>
                    <dxi-column alignment="right" dataField="SALVOCTYPE_NO" caption="Last Sale No." [allowResizing]="true" ></dxi-column>
                    <dxi-column alignment="right" dataField="SALDATE" caption="Last Sale Date" [allowResizing]="true" 
                    [customizeText]="customizeDateValue"></dxi-column>
                    <dxi-column alignment="right" dataField="SALAMOUNT1" caption="Last Sale Amount" [allowResizing]="true" 
                    [customizeText]="customizeContent"></dxi-column>
                    <dxi-column alignment="left" dataField="SALBRLOC" caption="Last Sale Branch" [allowResizing]="true" ></dxi-column>



                    <dxo-summary>
                        <dxi-total-item column="Sales Amount" summaryType="sum" displayFormat="{0}" alignment="right"
                        [customizeText]="customizeSummaryContent"></dxi-total-item>
                        <dxi-total-item column="Total Sales" summaryType="sum" displayFormat="{0}" alignment="right"
                        [customizeText]="customizeSummaryContent"></dxi-total-item>
                    </dxo-summary>
                </dx-data-grid>

                <div class="row mt-2" *ngIf="!isLoading">
                    <div class="col-md-3">
                        <input class="form-check-input" formControlName="showPicture" type="checkbox" id="flexSwitchCheckDefault">
                        <label class="form-check-label mx-2" for="showPicture" id="ID023">Show Picture</label>
                    </div>

                    <div class="col-md-4">
                        <mat-form-field appearance="outline" ngClass="me-1" style="width:100%">
                            <mat-select  formControlName="outputTo">
                              <mat-option value="Customer Log">Customer Log</mat-option>
                              <mat-option value="Sales Register">Sales Register</mat-option>
                              <mat-option value="Address Label">Address Label</mat-option>
                              <mat-option value="Previlage Card">Previlage Card</mat-option>
                              <mat-option value="Send Email">Send Email</mat-option>
                              <mat-option value="Send Card">Send Card</mat-option>
                              <mat-option value="Send SMS">Send SMS</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="label" class="col-form-label text-danger" id="ID024">Remove the Sales from date to List all Customers</label>
            </div>
            <div class="row" [ngClass]="{'loading-class': isLoading }">
                <div class="col-md-2 mt-4">
                    <button mat-flat-button color="primary" class="cancel-button Customer_btn-width mx-5"
                    (click)="customerSelection()"> Select Customer </button>
                </div>

                <div class="col-md-10">
                    <app-report-screen-buttons (saveTemplateClick)="saveTemplate()" (previewClicked)="previewClick()"
                    (printClicked)="printBtnClick()"></app-report-screen-buttons>
                </div>
            </div>
        </div>

        <dx-popup [width]="300" [height]="180" [showTitle]="true" container=".dx-viewport"
        title="Template Data" [dragEnabled]="false" [showCloseButton]="false" (onHidden)="popupClosed()"
        [visible]="popupVisible">
            <div class="popup-content">
                <div class="form-group">
                    <label for="T_Name">Name:</label>
                    <input type="text" id="T_Name" class="form-control" formControlName="templateName"/>
                </div>
                <div class="button-group d-flex">
                    <button mat-flat-button [ngClass]="{SaveNew_template: templateNameHasValue,
                        'btn-m-r-10': true, 'demo-button': true, 'btn-width': true, 'mx-1': true}"
                    (click)="saveTemplate_DB()">
                    {{ templateNameHasValue ? "Save as New Template" : "Save" }}
                    </button>
                    <button  mat-flat-button class="btn-m-r-10 btn-width mx-1 cancelBTN"
                    (click)="popupClosed()">
                    Cancel</button>
                </div>
            </div>
        </dx-popup>
    </form>
</div>